module.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/dist/",n(n.s=9)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=/^\s*<\/?[^>]+>\s*$/,i=/<[^\s>]+/,s=/^(\s|&nbsp;)+$/,a=/[\w\#@]+/,o=["<img"];function u(e){return!o.some(function(t){return null!==e&&e.startsWith(t)})&&r.test(e)}function l(e){return e=i.exec(e)[0]+(e.endsWith("/>")?"/>":">")}t.isTag=u,t.stripTagAttributes=l,t.wrapText=function(e,t,n){return["<",t,' class="',n,'">',e,"</",t,">"].join("")},t.isStartOfTag=function(e){return"<"===e},t.isEndOfTag=function(e){return">"===e},t.isStartOfEntity=function(e){return"&"===e},t.isEndOfEntity=function(e){return";"===e},t.isWhiteSpace=function(e){return s.test(e)},t.stripAnyAttributes=function(e){return u(e)?l(e):e},t.isWord=function(e){return a.test(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.blockSize=0,this.repeatingWordsAccuracy=0,this.ignoreWhitespaceDifferences=!1}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.startInOld=t,this.startInNew=n,this.size=r}return r(e,[{key:"endInOld",get:function(){return this.startInOld+this.size}},{key:"endInNew",get:function(){return this.startInNew+this.size}}]),e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={character:0,tag:1,whitespace:2,entity:3}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.convertHtmlToListOfWords=void 0;var r,i=n(3),s=(r=i)&&r.__esModule?r:{default:r},a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0));function o(e,t,n){0!==e.currentWord.length&&e.words.push(e.currentWord.join("")),e.currentWord=[t],e.mode=n}t.convertHtmlToListOfWords=function(e,t){for(var n={mode:s.default.character,currentWord:[],words:[]},r=function(e,t){var n=new Map;if(null===t)return n;var r=!0,i=!1,s=void 0;try{for(var a,o=t[Symbol.iterator]();!(r=(a=o.next()).done);r=!0)for(var u=a.value,l=void 0;null!==(l=u.exec(e));){if(n.has(l.index))throw new Error("One or more block expressions result in a text sequence that overlaps. Current expression: "+u.toString());n.set(l.index,l.index+l[0].length)}}catch(e){i=!0,s=e}finally{try{!r&&o.return&&o.return()}finally{if(i)throw s}}return n}(e,t),i=!!r.size,u=!1,l=-1,c=0;c<e.length;c++){var d=e[c];if(i&&(l===index&&(l=-1,u=!1),r.has(index)&&(u=!0,l=r.get(index)),u))n.currentWord.push(d),n.mode=s.default.character;else switch(n.mode){case s.default.character:a.isStartOfTag(d)?o(n,"<",s.default.tag):a.isStartOfEntity(d)?o(n,d,s.default.entity):a.isWhiteSpace(d)?o(n,d,s.default.whitespace):a.isWord(d)&&(0===n.currentWord.length||a.isWord(n.currentWord[n.currentWord.length-1]))?n.currentWord.push(d):o(n,d,s.default.character);break;case s.default.tag:a.isEndOfTag(d)?(n.currentWord.push(d),n.words.push(n.currentWord.join("")),n.currentWord=[],n.mode=a.isWhiteSpace(d)?s.default.whitespace:s.default.character):n.currentWord.push(d);break;case s.default.whitespace:a.isStartOfTag(d)?o(n,d,s.default.tag):a.isStartOfEntity(d)?o(n,d,s.default.entity):a.isWhiteSpace(d)?n.currentWord.push(d):o(n,d,s.default.character);break;case s.default.entity:if(a.isStartOfTag(d))o(n,d,s.default.tag);else if(a.isWhiteSpace(d))o(n,d,s.default.whitespace);else if(a.isEndOfEntity(d)){var f=!0;if(0!==n.currentWord.length&&(n.currentWord.push(d),n.words.push(n.currentWord.join("")),n.words.length>2&&a.isWhiteSpace(n.words[n.words.length-2])&&a.isWhiteSpace(n.words[n.words.length-1]))){var h=n.words[n.words.length-2],p=n.words[n.words.length-1];n.words.splice(words.length-2,2),n.currentWord=[(h+p).split()],n.mode=s.default.whitespace,f=!1}f&&(n.currentWord=[],n.mode=s.default.character)}else a.isWord(d)?n.currentWord.push(d):o(n,d,s.default.character)}}return 0!==n.currentWord.length&&n.words.push(n.currentWord.join("")),n.words}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=function e(t,n,r,i,s){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.action=t,this.startInOld=n,this.endInOld=r,this.startInNew=i,this.endInNew=s}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=a(n(2)),s=(a(n(1)),function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)));function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n){return e.push(t),e.length>n&&e.shift(),e.length!==n?null:e.join("")}var u=function(){function e(t,n,r,i,s,a,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.oldWords=t,this.newWords=n,this.startInOld=r,this.endInOld=i,this.startInNew=s,this.endInNew=a,this.options=o}return r(e,[{key:"indexNewWords",value:function(){this.wordIndices=new Map;for(var e=[],t=this.startInNew;t<this.endInNew;t++){var n=o(e,this.normalizeForIndex(this.newWords[t]),this.options.blockSize);null!==n&&(this.wordIndices.has(n)?this.wordIndices.get(n).push(t):this.wordIndices.set(n,[t]))}}},{key:"normalizeForIndex",value:function(e){return e=s.stripAnyAttributes(e),this.options.IgnoreWhiteSpaceDifferences&&s.isWhiteSpace(e)?" ":e}},{key:"findMatch",value:function(){if(this.indexNewWords(),this.removeRepeatingWords(),0===this.wordIndices.length)return null;for(var e=this.startInOld,t=this.startInNew,n=0,r=new Map,s=this.options.blockSize,a=[],u=this.startInOld;u<this.endInOld;u++){var l=o(a,this.normalizeForIndex(this.oldWords[u]),s);if(null!==l){var c=new Map;if(this.wordIndices.has(l)){var d=!0,f=!1,h=void 0;try{for(var p,v=this.wordIndices.get(l)[Symbol.iterator]();!(d=(p=v.next()).done);d=!0){var w=p.value,g=(r.has(w-1)?r.get(w-1):0)+1;c.set(w,g),g>n&&(e=u-g-s+2,t=w-g-s+2,n=g)}}catch(e){f=!0,h=e}finally{try{!d&&v.return&&v.return()}finally{if(f)throw h}}r=c}else r=c}}return 0!==n?new i.default(e,t,n+s-1):null}},{key:"removeRepeatingWords",value:function(){var e=this.newWords.length+this.options.repeatingWordsAccuracy,t=Array.from(this.wordIndices.entries()).filter(function(t){return t[1].length>e}).map(function(e){return e[0]}),n=!0,r=!1,i=void 0;try{for(var s,a=t[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var o=s.value;this.wordIndices.delete(o)}}catch(e){r=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}}}]),e}();t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={equal:0,delete:1,insert:2,none:3,replace:4}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=f(n(7)),s=f(n(2)),a=f(n(6)),o=f(n(5)),u=f(n(1)),l=d(n(4)),c=d(n(0));function d(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function f(e){return e&&e.__esModule?e:{default:e}}var h=new Map([["</strong>",0],["</em>",0],["</b>",0],["</i>",0],["</big>",0],["</small>",0],["</u>",0],["</sub>",0],["</strike>",0],["</s>",0]]),p=/<((strong)|(b)|(i)|(em)|(big)|(small)|(u)|(sub)|(sup)|(strike)|(s))[\>\s]+/gi,v=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.content=[],this.newText=n,this.oldText=t,this.specialTagDiffStack=[],this.newWords=[],this.oldWords=[],this.matchGranularity=0,this.blockExpressions=[],this.repeatingWordsAccuracy=1,this.ignoreWhiteSpaceDifferences=!1,this.orphanMatchThreshold=0}return r(e,[{key:"build",value:function(){if(this.oldText===this.newText)return this.newText;this.splitInputsIntoWords(),this.matchGranularity=Math.min(4,this.oldWords.length,this.newWords.length);var e=this.operations(),t=!0,n=!1,r=void 0;try{for(var i,s=e[Symbol.iterator]();!(t=(i=s.next()).done);t=!0){var a=i.value;this.performOperation(a)}}catch(e){n=!0,r=e}finally{try{!t&&s.return&&s.return()}finally{if(n)throw r}}return this.content.join("")}},{key:"addBlockExpression",value:function(e){this.blockExpressions.push(e)}},{key:"splitInputsIntoWords",value:function(){this.oldWords=l.convertHtmlToListOfWords(this.oldText,this.blockExpressions),this.oldText=null,this.newWords=l.convertHtmlToListOfWords(this.newText,this.blockExpressions),this.newText=null}},{key:"performOperation",value:function(e){switch(e.action){case i.default.equal:this.processEqualOperation(e);break;case i.default.delete:this.processDeleteOperation(e,"diffdel");break;case i.default.insert:this.processInsertOperation(e,"diffins");break;case i.default.none:break;case i.default.replace:this.processReplaceOperation(e)}}},{key:"processReplaceOperation",value:function(e){this.processDeleteOperation(e,"diffmod"),this.processInsertOperation(e,"diffmod")}},{key:"processInsertOperation",value:function(e,t){var n=this.newWords.filter(function(t,n){return n>=e.startInNew&&n<e.endInNew});this.insertTag("ins",t,n)}},{key:"processDeleteOperation",value:function(e,t){var n=this.oldWords.filter(function(t,n){return n>=e.startInOld&&n<e.endInOld});this.insertTag("del",t,n)}},{key:"processEqualOperation",value:function(e){var t=this.newWords.filter(function(t,n){return n>=e.startInNew&&n<e.endInNew});this.content.push(t.join(""))}},{key:"insertTag",value:function(e,t,n){for(;0!==n.length;){var r=this.extractConsecutiveWords(n,function(e){return!c.isTag(e)}),i="",s=!1;if(0!==r.length){var a=c.wrapText(r.join(""),e,t);this.content.push(a)}else{if(p.test(n[0])){if(this.specialTagDiffStack.push(n[0]),i='<ins class="mod">',"del"===e)for(n.shift();n.length>0&&p.test(n[0]);)n.shift()}else if(h.has(n[0])){var o=0===this.specialTagDiffStack.length?null:this.specialTagDiffStack.pop();if(null!==o&&o===n[0].replace(/\//g,"")&&(i="</ins>",s=!0),"del"===e)for(n.shift();n.length>0&&h.has(n[0]);)n.shift()}if(0===n.length&&0===i.length)break;s?this.content.push(i+this.extractConsecutiveWords(n,c.isTag).join("")):this.content.push(this.extractConsecutiveWords(n,c.isTag).join("")+i)}}}},{key:"extractConsecutiveWords",value:function(e,t){for(var n=null,r=0;r<e.length;r++){var i=e[r];if(0===r&&" "===i&&(e[r]="&nbsp;"),!t(i)){n=r;break}}if(null!==n){var s=e.filter(function(e,t){return t>=0&&t<n});return n>0&&e.splice(0,n),s}var a=e.filter(function(t,n){return n>=0&&n<e.length});return e.splice(0,e.length),a}},{key:"operations",value:function(){var e=0,t=0,n=[],r=this.matchingBlocks();r.push(new s.default(this.oldWords.length,this.newWords.length,0));var a=this.removeOrphans(r),u=!0,l=!1,c=void 0;try{for(var d,f=a[Symbol.iterator]();!(u=(d=f.next()).done);u=!0){var h=d.value,p=e===h.startInOld,v=t===h.startInNew,w=void 0;(w=p||v?p&&!v?i.default.insert:p?i.default.none:i.default.delete:i.default.replace)!==i.default.none&&n.push(new o.default(w,e,h.startInOld,t,h.startInNew)),0!==h.length&&n.push(new o.default(i.default.equal,h.startInOld,h.endInOld,h.startInNew,h.endInNew)),e=h.endInOld,t=h.endInNew}}catch(e){l=!0,c=e}finally{try{!u&&f.return&&f.return()}finally{if(l)throw c}}return n}},{key:"removeOrphans",value:regeneratorRuntime.mark(function e(t){var n,r,i,a,o,u,l,c,d,f,h;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=null,r=null,i=!0,a=!1,o=void 0,e.prev=5,u=t[Symbol.iterator]();case 7:if(i=(l=u.next()).done){e.next=31;break}if(c=l.value,null!==r){e.next=13;break}return n=new s.default(0,0,0),r=c,e.abrupt("continue",28);case 13:if(!(n.endInOld===r.startInOld&&n.endInNew===r.startInNew||r.endInOld===c.startInOld&&r.endInNew===c.startInNew)){e.next=19;break}return e.next=16,r;case 16:return n=r,r=c,e.abrupt("continue",28);case 19:if(d=function(e,t){return e+t.length},f=this.oldWords.slice(n.endInOld,c.startInOld).reduce(d,0),h=this.newWords.slice(n.endInNew,c.startInNew).reduce(d,0),!(this.newWords.slice(r.startInNew,r.endInNew).reduce(d,0)>Math.max(f,h)*this.orphanMatchThreshold)){e.next=26;break}return e.next=26,r;case 26:n=r,r=c;case 28:i=!0,e.next=7;break;case 31:e.next=37;break;case 33:e.prev=33,e.t0=e.catch(5),a=!0,o=e.t0;case 37:e.prev=37,e.prev=38,!i&&u.return&&u.return();case 40:if(e.prev=40,!a){e.next=43;break}throw o;case 43:return e.finish(40);case 44:return e.finish(37);case 45:return e.next=47,r;case 47:case"end":return e.stop()}},e,this,[[5,33,37,45],[38,,40,44]])})},{key:"matchingBlocks",value:function(){var e=[];return this.findMatchingBlocks(0,this.oldWords.length,0,this.newWords.length,e),e}},{key:"findMatchingBlocks",value:function(e,t,n,r,i){var s=this.findMatch(e,t,n,r);null!==s&&(e<s.startInOld&&n<s.startInNew&&this.findMatchingBlocks(e,s.startInOld,n,s.startInNew,i),i.push(s),s.endInOld<t&&s.endInNew<r&&this.findMatchingBlocks(s.endInOld,t,s.endInNew,r,i))}},{key:"findMatch",value:function(e,t,n,r){for(var i=this.matchGranularity;i>0;i--){var s=new u.default;s.blockSize=i,s.repeatingWordsAccuracy=this.repeatingWordsAccuracy,s.ignoreWhitespaceDifferences=this.ignoreWhiteSpaceDifferences;var o=new a.default(this.oldWords,this.newWords,e,t,n,r,s).findMatch();if(null!==o)return o}return null}}]),e}();v.execute=function(e,t){return new v(e,t).build()},t.default=v},function(e,t,n){e.exports=n(8)}]);